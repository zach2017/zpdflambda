server {
    listen 80;
    server_name localhost;
    root /usr/share/nginx/html;
    index index.html;

    # Serve static files
    location / {
        try_files $uri $uri/ /index.html;
    }

    # Proxy S3 upload bucket requests
    location /s3-upload/ {
        rewrite ^/s3-upload/(.*) /pdf-uploads/$1 break;
        proxy_pass http://localstack:4566;
        proxy_set_header Host localstack;
        proxy_http_version 1.1;
        proxy_set_header Connection "";
        client_max_body_size 100M;
    }

    # Proxy S3 output bucket requests
    location /s3-output/ {
        rewrite ^/s3-output/(.*) /pdf-text-output/$1 break;
        proxy_pass http://localstack:4566;
        proxy_set_header Host localstack;
        proxy_http_version 1.1;
        proxy_set_header Connection "";
    }

    # Proxy SQS requests
    location /sqs/ {
        rewrite ^/sqs/(.*) /000000000000/$1 break;
        proxy_pass http://localstack:4566;
        proxy_set_header Host localstack;
        proxy_http_version 1.1;
        proxy_set_header Connection "";
    }
}
